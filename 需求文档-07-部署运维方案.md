# 化妆品官网与后台管理系统需求文档 (7/8)

## 🚀 部署运维方案

### 1. 部署架构

**服务清单**:

| 服务 | 平台 | 说明 |
|------|------|------|
| 前台官网 | Vercel | SSR/SSG |
| 后台管理 | Vercel | SPA |
| 后端API | Vercel Serverless | API服务 |
| 数据库 | Vercel Postgres | PostgreSQL |
| Redis | Upstash | 缓存服务 |
| 文件存储 | Vercel Blob | 图片/视频 |

---

### 2. GitHub配置

#### 2.1 仓库结构

```
cosmetics-platform/
├── apps/
│   ├── frontend/
│   ├── admin/
│   └── server/
├── .github/workflows/
│   ├── deploy-frontend.yml
│   ├── deploy-admin.yml
│   └── deploy-server.yml
└── vercel.json
```

#### 2.2 环境变量

```bash
# 前台 (.env.frontend)
VITE_API_BASE_URL=https://api.example.com

# 后端 (.env.server)
DATABASE_URL=postgresql://...
REDIS_URL=redis://...
JWT_SECRET=xxx
```

---

### 3. Vercel部署配置

#### 前台配置 (vercel.json)

```json
{
  "version": 2,
  "name": "cosmetics-frontend",
  "builds": [
    {
      "src": "apps/frontend/package.json",
      "use": "@vercel/static-build"
    }
  ]
}
```

---

### 4. CI/CD流程

#### GitHub Actions配置

```yaml
name: Deploy Frontend
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: pnpm install
      - run: pnpm build
      - uses: amondnet/vercel-action@v25
```

---

### 5. 数据库迁移

```bash
# Prisma迁移
npx prisma migrate deploy

# 数据库备份
pg_dump $DATABASE_URL > backup.sql
```

---

### 6. 监控告警

**监控指标**:
- API响应时间
- 错误率
- 数据库连接数
- Redis命中率
- 服务器资源使用

**告警渠道**:
- 邮件通知
- 微信/钉钉机器人
- 短信告警

---

### 7. 安全措施

**安全配置**:
- HTTPS强制
- CORS配置
- 请求限流
- SQL注入防护
- XSS防护
- CSRF Token

---

### 8. 性能优化

**优化策略**:
- CDN加速
- 图片压缩
- 代码分割
- 懒加载
- Redis缓存
- 数据库索引

---

*文档版本：v1.0*
*下一部分：项目排期*
